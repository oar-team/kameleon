#
global:
 #
 # Where Kameleon stores tmp files and appliances
 workdir_base: /var/tmp/kameleon
 # 
 # Debian specific
 distrib: debian
 debian_version_name: squeeze
 distrib_repository: http://ftp.fr.debian.org/debian/
 output_environment_file_system_type: ext4
 #
 lustre_apt_source: 'deb http://pkg-lustre.alioth.debian.org/lustre lenny main'
 lustre_mds_partition_size: 10G
 lustre_oss_partition_size: 128G
 lustre_partition: /dev/sda5
 #
 nfs_partition_size: 128G
 nfs_partition: /dev/sda5
 nfs_export_file_system_type: ext4
 #
 #
 include_dir: /var/lib/kameleon/scripts
 #
 # Architecture
 arch: amd64
 kernel_arch: "amd64"
 #
 # Extra packages to install on the minimal base system
 extra_packages: "vim less screen strace bzip2 openssh-server rsync gnupg locales debian-keyring console-tools mingetty lsof perl e2fsprogs ntp ntpdate lvm2 iozone3 iperf htop subversion git git-svn ruby rubygems libyaml-perl libjson-perl mysql-server mysql-client sudo libdbi-perl libdbd-mysql-perl perl-suid taktuk pidentd curl hwloc"
 #
 # Network configuration
 network_hostname: kameleon
 # 
 checkpoint_file: /var/tmp/kameleon/checkpoints/lustre_checkpoint.tgz
 #
 # RJMS specific
 oar_repository: "deb http://oar.imag.fr/debian/2.5 unstable main"
 #oar_repository: "deb http://oar-ftp.imag.fr/oar/2.5/debian/ squeeze-snapshots main"
 #
 # slurm_repository: "http://sourceforge.net/projects/slurm/files/under_development"
 # slurm_version: "slurm-2.3.0-0.pre5"
 slurm_git_repository: "git://github.com/SchedMD/slurm.git"
 #
 # ESP
 # esp_repository: "git://scm.gforge.inria.fr/kameleon/esp.git"
 #
 # Xionee specific
 # cmdctrl_repository: "https://scm.gforge.inria.fr/svn/cmdctrl"
 # rctrl_repository: "https://scm.gforge.inria.fr/svn/rctrl"
 xionee_repository: "https://scm.gforge.inria.fr/svn/xionee"
 #
 # IOR
 ior_repository: 'http://sourceforge.net/projects/ior-sio/files/IOR%20latest/'
 ior_version: "IOR-2.10.3"
 #
 #  
steps:
 - debian_check_deps
 - check_deps:
   - rsync
   - building_appliance
   - building_kvm_images
 - checkpoint_resume
# - bootstrap
# - system_config
# - root_passwd
#  - mount_proc
#  - mount_dev
#  - mount_sys
 - software_install:
   - extra_packages
 - nfs_deps_install
 - nfs_install
# - umount_proc
# - kernel_install:
#   - kernel-img_conf
# - checkpoint
 - g5k_infiniband
 - g5k-update-host-name
# - g5k-ldap-config
 - lustre_kernel_install:
   - lustre_apt_config
   #- lustre_kernel_install_test
   - lustre_kernel_install_2.6.27
   - lustre_add_modules
   #- kernel_rename
 - root_ssh_config
 - lustre/lustre_utils_IB
 - lustre/lustre_IB
 - oar/oar_debian_install
 - oar/oar_system_config
 - oar/oar_config:
   - config_mysql
   - config_taktuk
   - config_oar_log_level
   - config_cpuset
   - oar_init
   - add_properties
 - oar/oar_devel
 - oar/oar_clean
 - slurm_deps_install
 - slurm/slurm_install:
   - create_munge_key
   - slurm_install_from_git
   - slurm_config
   - write_conf_files
   - init_dbd
 - ior_deps_install
 - io_benchmarks/ior_install
 - mpi/increase_memlock_limits
 - virt_tools_deps_install
 - virtualization/virt_tools
 - xionee/xionee_install:
   - xionee_checkout_trunk_only
   - xionee_checkout_R-branch_only
###############################
 - autologin
 - fix_locales
 - strip
 - build_appliance:
   - clean_udev
   - create_raw_image
   - create_nbd_device
   - mkfs
   - mount_image
   - copy_system_tree
   - install_grub
   - umount_image
   - save_as_raw
   #- save_as_vmdk
   - save_as_qcow2
   #- save_as_vdi
 - save_as_g5k
 - clean
